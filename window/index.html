<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="index.css" type="text/css">
    </head>
    <body>
        <h2>AKAI</h2><h2 id="name">APCmini</h2>
        <table>
            <tr>
                <td><div id="button56"></div></td><td><div id="button57"></div></td><td><div id="button58"></div></td><td><div id="button59"></div></td><td><div id="button60"></div></td><td><div id="button61"></div></td><td><div id="button62"></div></td><td><div id="button63"></div></td><td><div id="minibutton112"></div></td>
            </tr><tr>
                <td><div id="button48"></div></td><td><div id="button49"></div></td><td><div id="button50"></div></td><td><div id="button51"></div></td><td><div id="button52"></div></td><td><div id="button53"></div></td><td><div id="button54"></div></td><td><div id="button55"></div></td><td><div id="minibutton113"></div></td>
            </tr><tr>
                <td><div id="button40"></div></td><td><div id="button41"></div></td><td><div id="button42"></div></td><td><div id="button43"></div></td><td><div id="button44"></div></td><td><div id="button45"></div></td><td><div id="button46"></div></td><td><div id="button47"></div></td><td><div id="minibutton114"></div></td>
            </tr><tr>
                <td><div id="button32"></div></td><td><div id="button33"></div></td><td><div id="button34"></div></td><td><div id="button35"></div></td><td><div id="button36"></div></td><td><div id="button37"></div></td><td><div id="button38"></div></td><td><div id="button39"></div></td><td><div id="minibutton115"></div></td>
            </tr><tr>
                <td><div id="button24"></div></td><td><div id="button25"></div></td><td><div id="button26"></div></td><td><div id="button27"></div></td><td><div id="button28"></div></td><td><div id="button29"></div></td><td><div id="button30"></div></td><td><div id="button31"></div></td><td><div id="minibutton116"></div></td>
            </tr><tr>
                <td><div id="button16"></div></td><td><div id="button17"></div></td><td><div id="button18"></div></td><td><div id="button19"></div></td><td><div id="button20"></div></td><td><div id="button21"></div></td><td><div id="button22"></div></td><td><div id="button23"></div></td><td><div id="minibutton117"></div></td>
            </tr><tr>
                <td><div id="button08"></div></td><td><div id="button09"></div></td><td><div id="button10"></div></td><td><div id="button11"></div></td><td><div id="button12"></div></td><td><div id="button13"></div></td><td><div id="button14"></div></td><td><div id="button15"></div></td><td><div id="minibutton118"></div></td>
            </tr><tr>
                <td><div id="button00"></div></td><td><div id="button01"></div></td><td><div id="button02"></div></td><td><div id="button03"></div></td><td><div id="button04"></div></td><td><div id="button05"></div></td><td><div id="button06"></div></td><td><div id="button07"></div></td><td><div id="minibutton119"></div></td>
            </tr><tr id="minibuttons">
                <td><div id="minibutton100"></div></td><td><div id="minibutton101"></div></td><td><div id="minibutton102"></div></td><td><div id="minibutton103"></div></td><td><div id="minibutton104"></div></td><td><div id="minibutton105"></div></td><td><div id="minibutton106"></div></td><td><div id="minibutton107"></div></td><td><div id="minibutton122"></div></td>
            </tr><tr id="faders">
                <td><div id="fader68"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader69"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader70"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader71"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader72"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader73"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader74"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader75"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
                <td><div id="fader76"><div class="fader-slot"></div><div class="fader-knob"></div></div></td>
            </tr>
        </table>
        <div id="overlay">
            <div id="config-window">
                <h1></h1>
                <span>Color: </span>
                <select id="color">
                    <option value="0">black</option>
                    <option value="1">dimwhite</option>
                    <option value="3">white</option>
                    <option value="5">red</option>
                    <option value="7">dimred</option>
                    <option value="8">warmwhite</option>
                    <option value="9">orange</option>
                    <option value="13">yellow</option>
                    <option value="20">mintgreen</option>
                    <option value="21">green</option>
                    <option value="23">dimgreen</option>
                    <option value="25">seagreen</option>
                    <option value="37">cyan</option>
                    <option value="40">skyblue</option>
                    <option value="41">lavender</option>
                    <option value="45">blue</option>
                    <option value="49">violet</option>
                    <option value="50">uv</option>
                    <option value="53">magenta</option>
                    <option value="57">pink</option>
                    <option value="60">orangered</option>
                </select>
                <br><br>
                <span>Behavior: </span>
                <select id="behavior">
                    <option value="0">10% brightness</option>
                    <option value="1">25% brightness</option>
                    <option value="2">50% brightness</option>
                    <option value="3">65% brightness</option>
                    <option value="4">75% brightness</option>
                    <option value="5">90% brightness</option>
                    <option value="6" selected>100% brightness</option>
                    <option value="7">Breathing 1/16</option>
                    <option value="8">Breathing 1/8</option>
                    <option value="9">Breathing 1/4</option>
                    <option value="10">Breathing 1/2</option>
                    <option value="11">Flashing 1/24</option>
                    <option value="12">Flashing 1/16</option>
                    <option value="13">Flashing 1/8</option>
                    <option value="14">Flashing 1/4</option>
                    <option value="15">Flashing 1/2</option>
                </select>
                <br><br>
                <button id="confirm" onclick="setButton(selectedNote, document.getElementById('color').value, document.getElementById('behavior').value)">Confirm</button>
                <button id="exit" onclick="clearPopups()">Exit</button>
            </div>
            <div id="error-window">
                <h2></h2>
                <p></p>
            </div>
        </div>
        <script>
            let selectedNote;

            function setFader(number, value) {
                document.querySelector(`#fader${number} .fader-knob`).style.bottom = Math.round(value / 127 * 136) + "px";
            }

            function setButton(number, to, behavior) {
                if (number >= 112) {
                    document.querySelector(`#minibutton${number}`).style.backgroundColor = (document.querySelector(`#minibutton${number}`).style.backgroundColor) ? "" : "limegreen";
                    electronAPI.miniButtonToggle(number, document.querySelector(`#minibutton${number}`).style.backgroundColor != "");
                } else if (number >= 100) {
                    document.querySelector(`#minibutton${number}`).style.backgroundColor = (document.querySelector(`#minibutton${number}`).style.backgroundColor) ? "" : "red";
                    electronAPI.miniButtonToggle(number, document.querySelector(`#minibutton${number}`).style.backgroundColor != "");
                } else {
                    const mapping = {
                        v0: "#555",
                        v1: "#999",
                        v3: "#ffffff",
                        v5: "#ff0000",
                        v7: "#660000",
                        v8: "#ffbd6c",
                        v9: "#ff5400",
                        v13: "#ffff00",
                        v20: "#4cff4c",
                        v21: "#00ff00",
                        v23: "#006600",
                        v25: "#00ff19",
                        v37: "#00a9ff",
                        v40: "#4c88ff",
                        v41: "#0055ff",
                        v45: "#0000ff",
                        v49: "#5400ff",
                        v50: "#190064",
                        v53: "#ff00ff",
                        v57: "#ff0054",
                        v60: "#ff1500"
                    };
                    document.querySelector(`#button${number}`).style.backgroundColor = mapping[`v${to}`];
                    electronAPI.setColor(number, to, behavior);
                    document.querySelector(`#button${number}`).style.animationName = (behavior >= 7) ? "buttonfx" : "";
                    if (behavior >= 7 && behavior <= 10) {
                        const speeds = [0.2, 0.22, 0.25, 0.5];
                        document.querySelector(`#button${number}`).style.animationDuration = `${speeds[behavior - 7]}s`;
                        document.querySelector(`#button${number}`).style.animationTimingFunction = "";
                    } else if (behavior >= 10) {
                        const speeds = [0.125, 0.2, 0.22, 0.25, 0.5];
                        document.querySelector(`#button${number}`).style.animationDuration = `${speeds[behavior - 10]}s`;
                        document.querySelector(`#button${number}`).style.animationTimingFunction = "steps(1, end)";
                    }

                    clearPopups();
                }
            }

            function error(head, desc) {
                document.getElementById("overlay").style.display = "block";
                document.getElementById("error-window").style.display = "block";
                document.querySelector("#error-window h2").innerHTML = head;
                document.querySelector("#error-window p").innerHTML = desc;
                document.getElementById("config-window").style.display = "none";
            }
            
            function config(number) {
                selectedNote = number;
                document.getElementById("overlay").style.display = "block";
                document.getElementById("config-window").style.display = "block";
                document.querySelector("#config-window h1").innerHTML = `Configure pad ${number}`;
                document.getElementById("error-window").style.display = "none";
            }

            function clearPopups() {
                document.getElementById("overlay").style.display = "none";
                document.getElementById("error-window").style.display = "none";
                document.getElementById("config-window").style.display = "none";
            }

            function press(note, state) {
                const noteID = (note >= 10) ? note : ("0" + note).slice(-2);
                document.querySelector(`div[id$="button${noteID}"]`).style.boxShadow = (state) ? "0 0 5px #eee" : "";
            }
            
            function lock(state) {
                if (state) error("Locked!", "Please unlock to continue.");
                else clearPopups();
            }

            window.addEventListener("keydown", function(e) {
                if (e.key == "l" && e.ctrlKey) electronAPI.toggleLock();
            });

            for (const i of document.querySelectorAll('div[id^="button"]')) {
                i.addEventListener("mousedown", function(e) {
                    const number = e.target.id.match(/button(\d+)/)[1];
                    if (e.buttons == 1) electronAPI.buttonPress(number);
                    else if (e.buttons == 2) config(number);
                });
            }
            for (const i of document.querySelectorAll('div[id^="minibutton"]')) {
                if (i.id.endsWith("122")) continue;
                i.addEventListener("mousedown", function(e) {
                    const number = e.target.id.match(/minibutton(\d+)/)[1];
                    if (e.buttons == 1) electronAPI.buttonPress(number);
                    else if (e.buttons == 2) setButton(number);
                });
            }
        </script>
    </body>
</html>
